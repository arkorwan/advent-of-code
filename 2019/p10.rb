mp_txt = "
.##.#.#....#.#.#..##..#.#.
#.##.#..#.####.##....##.#.
###.##.##.#.#...#..###....
####.##..###.#.#...####..#
..#####..#.#.#..#######..#
.###..##..###.####.#######
.##..##.###..##.##.....###
#..#..###..##.#...#..####.
....#.#...##.##....#.#..##
..#.#.###.####..##.###.#.#
.#..##.#####.##.####..#.#.
#..##.#.#.###.#..##.##....
#.#.##.#.##.##......###.#.
#####...###.####..#.##....
.#####.#.#..#.##.#.#...###
.#..#.##.#.#.##.#....###.#
.......###.#....##.....###
#..#####.#..#..##..##.#.##
##.#.###..######.###..#..#
#.#....####.##.###....####
..#.#.#.########.....#.#.#
.##.#.#..#...###.####..##.
##...###....#.##.##..#....
..##.##.##.#######..#...#.
.###..#.#..#...###..###.#.
#..#..#######..#.#..#..#.#"

ast = []
mp_txt.split.each_with_index{|r,y| r.chars.each_with_index{|c,x| ast << [x,y] if c == '#'} }

angles = []

ast.each_with_index{|a, i|
	ang = {}
	ast.each_with_index{|b, j|
		next if j == i
		x,y = a[0]-b[0], a[1]-b[1]
		g = x.gcd(y)
		k = [x/g, y/g]
		ang[k] ||= []
		ang[k] << [b[0],b[1],g]
	}
	angles << ang
}

station = angles.max_by{|k|k.values.size}

# # part 1
p station.values.size

# part 2
order = []
station.each{|k, vs|
	angle = -Math.atan2(k[0], k[1]) * 180 / Math::PI
	angle += 360 if angle < 0
	vs.sort_by{|v| v[2]}.each_with_index{|v, i|
		order << [i, angle, v[0..1]]
	}
}

p order.sort[199]
